---
// GleHi.astro
---

<section class="glehi-hero" id="waitlist">
  <div class="container">
    <div class="content-wrapper">
      <!-- Texte principal -->
      <div class="main-content">
        <h1 class="title">
          Prêts à Transformer l'Agriculture<br />
          au Bénin ?
        </h1>

        <div class="cta-section">
          <div class="producers-section">
            <p class="subtitle">
              <strong>Producteurs :</strong> Rejoignez<br />
              notre réseau et commencez à<br />
              vendre plus efficacement !
            </p>

            <!-- Formulaire Waiting List Producteurs -->
            <form class="waitlist-form" id="producer-form">
              <input
                type="email"
                name="email"
                placeholder="Votre adresse e-mail"
                required
                class="email-input"
              />
              <button type="submit" class="cta-button">
                Inscription Producteur
              </button>
            </form>
            <p class="success-message" id="producer-success"></p>
          </div>
        </div>
      </div>

      <!-- Mobile Visuals -->
      <div class="mobile-visuals">
        <div class="mobile-screen">
          <img
            src="/images/inscription_glehi.png"
            alt="Mockup de l'application GleHi"
          />
        </div>
      </div>

      <!-- Section acheteurs -->
      <div class="buyers-section">
        <p class="buyers-text">
          <strong>Acheteurs :</strong> Découvrez la<br />
          fraîcheur locale et soutenez nos<br />
          producteurs !
        </p>

        <!-- Formulaire Waiting List Acheteurs -->
        <form class="waitlist-form buyers-form" id="buyer-form">
          <input
            type="email"
            name="email"
            placeholder="Votre adresse e-mail"
            required
            class="email-input"
          />
          <button type="submit" class="cta-button"> Rejoindre la liste </button>
        </form>
        <p class="success-message" id="buyer-success"></p>

        <div class="download-buttons">
          <span class="coming-soon">Bientôt disponible sur :</span>
          <div class="store-badges">
            <div class="download-btn google-play disabled">
              <span class="download-text">Télécharger sur</span>
              <span class="store-name">Google Play</span>
            </div>
            <div class="download-btn app-store disabled">
              <span class="download-text">Télécharger sur</span>
              <span class="store-name">App Store</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .glehi-hero {
    background: linear-gradient(135deg, #a8c589 0%, #8fb070 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    padding: 2rem 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    width: 100%;
  }

  .content-wrapper {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 3rem;
    align-items: center;
    min-height: 500px;
  }

  .main-content {
    text-align: left;
  }

  .title {
    font-size: 2.5rem;
    font-weight: bold;
    color: white;
    margin-bottom: 3rem;
    line-height: 1.2;
  }

  .subtitle {
    color: white;
    font-size: 1.1rem;
    line-height: 1.4;
    margin-bottom: 1.5rem;
  }

  /* Formulaire Waiting List */
  .waitlist-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .buyers-form {
    align-items: flex-end;
  }

  .email-input {
    padding: 0.8rem 1rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    font-size: 1rem;
    background: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
    width: 100%;
    max-width: 300px;
  }

  .email-input:focus {
    outline: none;
    border-color: white;
    background: white;
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
  }

  .email-input::placeholder {
    color: #666;
  }

  .cta-button {
    background-color: #5a7c41;
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    width: fit-content;
  }

  .cta-button:hover {
    background-color: #4a6635;
    transform: translateY(-2px);
  }

  .cta-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .success-message {
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    display: none;
    animation: slideIn 0.3s ease;
  }

  .success-message.show {
    display: block;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .mobile-visuals {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2rem 0;
  }

  .mobile-screen {
    max-width: 400px;
    width: 100%;
  }

  .mobile-screen img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
  }

  .mobile-screen img:hover {
    transform: scale(1.02);
  }

  .buyers-section {
    text-align: right;
  }

  .buyers-text {
    color: white;
    font-size: 1.1rem;
    line-height: 1.4;
    margin-bottom: 2rem;
  }

  .download-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: flex-end;
    margin-top: 2rem;
  }

  .coming-soon {
    color: white;
    font-size: 0.9rem;
    font-style: italic;
    opacity: 0.9;
  }

  .store-badges {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }

  .download-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.8rem 1.2rem;
    border-radius: 8px;
    text-decoration: none;
    color: white;
    font-weight: 600;
    transition: all 0.3s ease;
    min-width: 160px;
  }

  .google-play {
    background: #5a7c41;
  }

  .app-store {
    background: #4a6635;
  }

  .download-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .download-text {
    font-size: 0.8rem;
    opacity: 0.9;
  }

  .store-name {
    font-size: 1rem;
    font-weight: bold;
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .content-wrapper {
      grid-template-columns: 1fr;
      gap: 2rem;
      text-align: center;
    }

    .main-content {
      text-align: center;
    }

    .title {
      font-size: 2rem;
    }

    .waitlist-form {
      align-items: center;
    }

    .buyers-form {
      align-items: center;
    }

    .mobile-screen {
      max-width: 320px;
    }

    .buyers-section {
      text-align: center;
    }

    .download-buttons {
      align-items: center;
    }
  }

  @media (max-width: 768px) {
    .glehi-hero {
      padding: 1rem 0;
    }

    .container {
      padding: 0 1rem;
    }

    .title {
      font-size: 1.8rem;
      margin-bottom: 2rem;
    }

    .mobile-visuals {
      padding: 1rem 0;
    }

    .mobile-screen {
      max-width: 280px;
    }

    .subtitle,
    .buyers-text {
      font-size: 1rem;
    }

    .email-input {
      max-width: 100%;
    }

    .store-badges {
      flex-direction: row;
      justify-content: center;
      flex-wrap: wrap;
    }

    .download-btn {
      flex-direction: column;
      text-align: center;
      min-width: 120px;
      padding: 0.6rem;
    }
  }

  @media (max-width: 480px) {
    .title {
      font-size: 1.5rem;
    }

    .mobile-screen {
      max-width: 240px;
    }

    .store-badges {
      flex-direction: column;
      gap: 0.8rem;
    }

    .download-btn {
      min-width: 140px;
    }
  }
</style>

<script>
  // Gestion du formulaire Producteurs
  const producerForm = document.getElementById(
    "producer-form"
  ) as HTMLFormElement | null;
  const producerSuccess = document.getElementById(
    "producer-success"
  ) as HTMLParagraphElement | null;

  if (producerForm && producerSuccess) {
    producerForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(producerForm);
      const email = formData.get("email");
      const button = producerForm.querySelector(
        "button"
      ) as HTMLButtonElement | null;

      // Désactiver le bouton
      if (button) button.disabled = true;

      try {
        // Appel API pour enregistrer l'email (à adapter selon votre backend)
        const response = await fetch(
          "https://glehi.onrender.com/api/waitlist",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              email: email,
              type: "producteur",
            }),
          }
        );

        if (response.ok) {
          producerSuccess.textContent =
            "✓ Merci ! Nous vous contacterons bientôt.";
          producerSuccess.classList.add("show");
          producerForm.reset();

          setTimeout(() => {
            producerSuccess.classList.remove("show");
          }, 5000);
        } else {
          throw new Error("Erreur lors de l'inscription");
        }
      } catch (error) {
        producerSuccess.textContent =
          "✗ Une erreur est survenue. Réessayez plus tard.";
        producerSuccess.classList.add("show");
        producerSuccess.style.background = "rgba(255, 59, 48, 0.2)";

        setTimeout(() => {
          producerSuccess.classList.remove("show");
          producerSuccess.style.background = "rgba(255, 255, 255, 0.2)";
        }, 5000);
      } finally {
        if (button) button.disabled = false;
      }
    });
  }

  // Gestion du formulaire Acheteurs
  const buyerForm = document.getElementById(
    "buyer-form"
  ) as HTMLFormElement | null;
  const buyerSuccess = document.getElementById(
    "buyer-success"
  ) as HTMLParagraphElement | null;

  if (buyerForm && buyerSuccess) {
    buyerForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(buyerForm);
      const email = formData.get("email");
      const button = buyerForm.querySelector(
        "button"
      ) as HTMLButtonElement | null;

      if (button) button.disabled = true;

      try {
        const response = await fetch(
          "https://glehi.onrender.com/api/waitlist",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              email: email,
              type: "acheteur",
            }),
          }
        );

        if (response.ok) {
          buyerSuccess.textContent =
            "✓ Merci ! Nous vous contacterons bientôt.";
          buyerSuccess.classList.add("show");
          buyerForm.reset();

          setTimeout(() => {
            buyerSuccess.classList.remove("show");
          }, 5000);
        } else {
          throw new Error("Erreur lors de l'inscription");
        }
      } catch (error) {
        buyerSuccess.textContent =
          "✗ Une erreur est survenue. Réessayez plus tard.";
        buyerSuccess.classList.add("show");
        buyerSuccess.style.background = "rgba(255, 59, 48, 0.2)";

        setTimeout(() => {
          buyerSuccess.classList.remove("show");
          buyerSuccess.style.background = "rgba(255, 255, 255, 0.2)";
        }, 5000);
      } finally {
        if (button) button.disabled = false;
      }
    });
  }
</script>
